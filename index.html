<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Player</title>
    <link
      rel="shortcut icon"
      href="https://static.tildacdn.com/tild6535-3931-4534-a462-643438616464/favicon.ico"
      type="image/x-icon"
    />
    <style>
      iframe[id^='sb__open-sandbox'] {
        top: 50%;
      }
    </style>
  </head>
  <body>
    <div id="player"></div>

    <script>
      function createPlayer() {
        const Player = Kinescope.IframePlayer;
        return Player.create('player', {
          url: 'https://kinescope.io/200633204',

          size: { width: '50%', height: 400 },

          behaviour: {
            // preload: true,
            // autoPlay: true,
            // crossOrigin: 'use-credentials',
          },

          settings: {
            // driverSettings: {
            //   hls: { playback: 'native' },
            // },
            // metrics: {
            //   interval: 2000,
            // },
          },

          // Yandex Ads integration - standard approach
          ads: [{
            type: 'yandex',
            config: {
              partnerId: 291193,
              category: 0,
            },
            trigger: {
              timePoints: [0]
            }
          }],
        }).then((player) => {
          console.log('player initialized');

          // Listen for ad events
          player.on(Player.PlayerEvent.AdStart, (event) => {
            console.log('Ad started:', event);
          });

          player.on(Player.PlayerEvent.AdEnd, (event) => {
            console.log('Ad ended:', event);
          });

          player.on(Player.PlayerEvent.AdError, (event) => {
            console.error('Ad error:', event);
          });

          // player.on(Player.PlayerEvent.FullscreenChange, ({ data }) => {
          //   if (!data.isFullscreen) return;

          //   setTimeout(async () => {
          //     await player.destroy();

          //     if (!document.getElementById('player')) {
          //       const container = document.createElement('div');
          //       container.id = 'player';
          //       document.body.appendChild(container);
          //     }

          //     await createPlayer();
          //   }, 5000);
          // });
        });
      }

      function onKinescopeIframeAPIReady(Player) {
        console.log('iframe api ready', Player);
        createPlayer();
      }

      // Ensure DOM is loaded before loading the player script
      document.addEventListener('DOMContentLoaded', function() {
        // Load the player script after DOM is ready
        const script = document.createElement('script');
        script.async = true;
        script.src = 'https://player.kinescope.dev/latest/iframe.player.js';
        document.head.appendChild(script);
      });
    </script>
  </body>
</html>
